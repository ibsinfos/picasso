var SABAI=SABAI||{};(function(c){SABAI.console=window.console||{log:function(d){alert(d)}};SABAI.isRTL=false;SABAI.init=(function(){var h=function(l){SABAI.fadeout(c(".sabai-fadeout",l))},k=function(l){c("input.sabai-form-check-trigger",l).show().click(function(){var m=c(this);m.closest("table").find("input.sabai-form-check-target, input.sabai-form-check-trigger").not(":disabled").prop("checked",m.prop("checked"))})},g=function(l){c("fieldset.sabai-form-collapsible",l).not(".sabai-form-collapsible-processed").each(function(){var m=c(this);m.find("> legend span:first").prepend('<i class="fa fa-caret-down"></i> ').wrap('<a class="sabai-form-collapsible" href="#"></a>').end().find("a.sabai-form-collapsible:first").click(function(){c(this).toggleClass("sabai-form-collapsed").find("i").toggleClass("fa-caret-down").toggleClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right").end().closest(".sabai-form-collapsible-processed").toggleClass("sabai-form-collapsed").find(".sabai-form-fields:first").slideToggle("fast",function(){c(this).find("textarea:visible").autosize()});return false}).end().addClass("sabai-form-collapsible-processed");if(m.hasClass("sabai-form-collapsed")){if(m.hasClass("sabai-form-field-error")){m.removeClass("sabai-form-collapsed")}else{m.find(".sabai-form-fields:first").css({display:"none"}).end().find("a.sabai-form-collapsible:first").addClass("sabai-form-collapsed").find("i").removeClass("fa-caret-down").addClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right")}}})},j=function(l){c("textarea:visible",l).autosize()},e=function(l){var m="ontouchstart" in document.documentElement;if(!m){c('[rel="sabaitooltip"]',l).each(function(){var o=c(this),n=l.attr("id")==="sabai-content"&&o.closest("#sabai-inline-content").length?o.closest("#sabai-inline-content"):o.data("container")||l;o.sabaitooltip({container:n})})}c("a[data-popover-url]",l).bind("click",function(t){var s=c(this).unbind("hover"),r=s.attr("data-content"),n;t.preventDefault();n=l.attr("id")==="sabai-content"&&s.closest("#sabai-inline-content").length?s.closest("#sabai-inline-content"):s.data("container")||l;if(typeof r==="undefined"||r===false){var p=s.data("popover-url"),o=SABAI.cache(p),q;if(SABAI.isRTL){q=function(u,v){return c(v).offset().left>300?"left":"right"}}else{q=function(u,v){return window.innerWidth-c(v).offset().left>300?"right":"left"}}if(!o){c.get(p,{__ajax:1},function(u){SABAI.cache(p,u);SABAI.popover(s.attr("data-content",u),{html:true,container:n,placement:q})})}else{SABAI.popover(s.attr("data-content",o),{html:true,container:n,placement:q})}}})},i=function(l){c("a.sabai-toggle",l).not(".sabai-toggle-processed").unbind("click").click(function(q){var p=c(this).addClass("sabai-toggle-processed"),o=c(p.data("toggle-target"));if(!c.trim(o.html())){return}c(SABAI).trigger("toggle.sabai",{trigger:p,target:o});var n=p.data("toggle-cookie"),m=p.hasClass("sabai-toggle-slide")?"slideToggle":"toggle";o[m]("fast",function(){var r=o.is(":visible");p.toggleClass("sabai-active",r);if(n){c.cookie(n,r?1:0,{path:SABAI.path,domain:SABAI.domain})}c(SABAI).trigger("toggled.sabai",{trigger:p,target:o})});q.preventDefault()})},f=function(l){c(".sabai-carousel",l).each(function(){var m=c(this);m.data("carousel",m.bxSlider(m.data("carousel-options")||{}));c(SABAI).bind("entity_filter_form_toggled.sabai",function(o,n){if(m.parents(n.container).length){m.data("carousel").redrawSlider()}})})},d=function(l){c("a.sabai-form-field-add",l).each(function(){var n=c(this),o=n.closest(".sabai-form-fields"),m=parseInt(n.data("field-max-num"));n.click(function(q){var p=n.data("field-next-index");SABAI.cloneField(o,n.data("field-name"),m,p,n);if(p){n.data("field-next-index",++p)}q.preventDefault()});o.find("> .sabai-form-field:not(.sabai-form-field-add)").each(function(p){if(p===0){return}c(this).append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').find("a.sabai-form-field-remove").click(function(q){c(this).closest(".sabai-form-field").fadeTo("fast",0,function(){c(this).slideUp("fast",function(){c(this).remove();if(m&&o.find("> .sabai-form-field:not(.sabai-form-field-add)").length<m){n.show()}})});q.preventDefault()}).parent().css("position","relative")});if(m&&o.find("> .sabai-form-field:not(.sabai-form-field-add)").length>=m){n.hide()}})};return function(l,m){h(l);k(l);g(l);j(l);e(l);i(l);f(l);d(l);if(typeof prettyPrint==="function"){prettyPrint()}if(typeof c.fn.prettyPhoto==="function"){c('a[rel^="prettyPhoto"]',l).prettyPhoto()}c(".sabai-dropdown-toggle",l).sabaidropdown();c(".sabai-click",l).click();if(m){m.call(null,l)}c(SABAI).trigger("sabai_init.sabai",{context:l})}}());SABAI.fadeout=function(d,e){e=e||6000;c(d).animate({opacity:"+=0"},e,function(){c(this).fadeOut("fast",function(){c(this).remove()})})};SABAI.cache=(function(){var d={};return function(g,f,e){if(arguments.length==1){if(!d[g]){return false}if(d[g]["expires"]<new Date().getTime()){return false}return d[g]["data"]}e=e||600;d[g]={data:f,expires:new Date().getTime()+e*1000}}}());SABAI.flash=function(f,e){if(typeof f==="undefined"||f===null){return}if(typeof(f)=="string"){c.growl(f,{type:e,delay:e==="danger"?0:5000,z_index:999999})}else{for(var d=0;d<f.length;d++){SABAI.flash(f[d].msg,f[d].level)}}};SABAI.load=function(e,g,f){var d=c(e);d.load(g,{__ajax:e},function(i,h,j){SABAI.init(d);if(f){f.call(d,i,h,j)}});return d};SABAI.replace=function(f,h,g,e){var d;c.get(h,{__ajax:f},function(j,i,k){if(e){d=c(f).html(j)}else{c(f).replaceWith(j);d=c(f)}SABAI.init(d);if(g){g.call(null,d,j,i,k)}});return d};SABAI.popover=function(f,d,e){f=f instanceof jQuery?f:c(f);if(!e&&f.hasClass("sabai-popover-processed")){return}d=d||{};d.template='<div class="sabai-popover"><div class="sabai-arrow"></div><div class="sabai-popover-inner"><div class="sabai-close"><i class="fa fa-times"></i></div><div class="sabai-popover-title"></div><div class="sabai-popover-content"></div></div></div>';f.sabaipopover(d).sabaipopover("show").addClass("sabai-popover-processed").data("bs.sabaipopover").tip().css(d.width?{width:d.width}:{}).find(".sabai-close").on("click",function(){f.data("bs.sabaipopover").hide()});if(!SABAI.popoverInit){c("body").on("click",function(g){c(".sabai-popover-processed").each(function(){if(!c(this).is(g.target)&&c(this).has(g.target).length===0&&c(".sabai-popover").has(g.target).length===0){c(this).sabaipopover("hide")}})})}};SABAI.modal=(function(){var d,f=function(){var g=c('<div class="sabai" id="sabai-modal" style="display:none;"><div class="sabai-modal-container"><div class="sabai-modal-title"><span></span><span class="sabai-close"><i class="fa fa-times"></i></span></div><div class="sabai-modal-content"></div><div class="sabai-modal-footer"></div></div></div>').prependTo("body").find(".sabai-close").mousedown(function(){c("#sabai-modal").fadeOut("fast",function(){c(this).remove()})}).end();c(document).keyup(function(h){if(h.keyCode==27){c("#sabai-modal").find(".sabai-close").mousedown()}});return g},e=function(j,i){var k,g,h=document.documentElement.clientWidth<=768?0.95:0.8;if(i===null||i>document.documentElement.clientWidth*h){i=document.documentElement.clientWidth*h}j.find(".sabai-modal-container").css({width:i+"px",left:SABAI.isRTL?"auto":document.documentElement.clientWidth/2-i/2,right:SABAI.isRTL?document.documentElement.clientWidth/2-i/2:"auto",top:document.documentElement.clientHeight*0.07});if(j.find(".sabai-form-buttons").length){g=j.find(".sabai-form-buttons").outerHeight()+10}else{g=20}j.find(".sabai-modal-footer").css("height",g+"px");k=document.documentElement.clientHeight*0.8-j.find(".sabai-modal-title").outerHeight()-g;j.find(".sabai-modal-content").css("max-height",k+"px");if(j.get(0).scrollHeight>document.documentElement.clientHeight){j.find(".sabai-modal-content").css("height",k+"px")}};return function(i,j,g,h){if(h){d=h}else{if(c("body").has("#sabai-modal").length){d=c("#sabai-modal")}else{d=f()}}if(j||i){if(j){d.find(".sabai-modal-title > span:first").text(j)}if(i){d.find(".sabai-modal-content").html(i)}d.show()}if(typeof g!=="undefined"){if(g===0){g=d.find(".sabai-modal-container").width()}e(d,g)}return d}}());SABAI.ajaxLoader=function(h,f,i){var e=c(h);if(i){var d=c(i);if(!d.length){return}if(!f){var g=c('<div class="sabai-ajax-loader"></div>').css("top",parseInt(d.position().top,10)+parseInt(d.css("margin-top"),10)+"px").width(d.outerWidth()).height(d.outerHeight());d.after(g)}else{d.next(".sabai-ajax-loader").remove()}if(e.length){e.blur().prop("disabled",!f).css("pointer-events",f?"auto":"none")}}else{if(!e.length){return}e.blur().prop("disabled",!f).css("pointer-events",f?"auto":"none").toggleClass("sabai-ajax-loading",!f)}};SABAI.ajax=function(l){var d=c.extend({trigger:null,async:true,type:"get",url:"",data:"",processData:true,target:"",container:null,modalWidth:null,cache:false,cacheLifetime:600,onSendData:null,onSuccess:null,onError:null,onErrorFlash:true,onContent:null,onSuccessFlash:false,effect:null,scroll:false,replace:false,highlight:false,callback:false,loadingImage:true,position:false,toggle:false,pushState:false,state:{}},l),j,e="",g,k=function(n,p){try{var m=JSON.parse(n.replace(/<!--[\s\S]*?-->/g,""));if(d.onSuccess){if(!d.onSuccess(m,p,d.trigger)){if(d.onSuccessFlash&&m.messages){SABAI.flash(m.messages,"success")}return}}if(m.url){if(d.container==="#sabai-modal"){c("#sabai-modal").hide()}window.location=m.url;return}if(d.onSuccessFlash&&m.messages){SABAI.flash(m.messages,"success")}}catch(o){SABAI.console.log("Failed parsing response:<p>"+n.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+o.toString()+"</p>")}},i=function(o,r){if(d.container==="#sabai-modal"){if(d.trigger){var p=d.trigger.attr("data-modal-title");if(typeof p==="undefined"||p===false){p=d.trigger.attr("title")||d.trigger.attr("data-original-title")||""}SABAI.modal(o,p,d.modalWidth,r)}else{SABAI.modal(o,"",d.modalWidth,r)}if(!d.onContent){d.onContent=function(s,u,t){u.focusFirstInput()}}d.onContent(o,r,d.trigger)}else{if(d.trigger&&d.trigger.hasClass("sabai-toggle")){c(SABAI).trigger("toggle.sabai",{trigger:d.trigger,target:r})}if(d.replace){if(d.scroll&&e){SABAI.scrollTo(e)}r=r.hide().after(o).remove().next();if(d.onContent){d.onContent(o,r,d.trigger)}}else{if(!d.callback&&r.attr("id")!="sabai-content"&&r.attr("id")!="sabai-inline-content"){r.addClass("sabai-ajax")}switch(d.effect){case"slide":r.hide().html(o).slideDown("fast",function(){if(d.onContent){d.onContent(o,r,d.trigger)}});break;default:r.html(o).show();if(d.onContent){d.onContent(o,r,d.trigger)}}if(d.scroll&&e){SABAI.scrollTo(e)}}if(d.highlight){r.effect("highlight",{},1500)}if(d.trigger&&d.trigger.hasClass("sabai-toggle")){var n=r.is(":visible");d.trigger.removeAttr("onclick").removeClass("sabai-click").toggleClass("sabai-active",n);var q=d.trigger.data("toggle-cookie");if(q){c.cookie(q,n?1:0,{path:SABAI.path,domain:SABAI.domain})}c(SABAI).trigger("toggled.sabai",{trigger:d.trigger,target:r})}}if(d.pushState&&window.history&&window.history.pushState){var m=SABAI.parseUrl(d.url);if(m.pathname!==location.pathname){m.pathname=location.pathname}d.state.data=d.data;d.state.url=d.url;d.state.container=d.container;d.state.target=d.target;window.history.pushState(d.state,null,m.toString())}SABAI.init(r);c(SABAI).trigger("loaded.sabai",{target:r,selector:e})},h=function(m,p){try{var n=JSON.parse(m.replace(/<!--[\s\S]*?-->/g,""));if(d.onError){if(!d.onError(n,p,d.trigger)){if(d.onErrorFlash&&n.messages){SABAI.flash(n.messages,"danger")}return}}else{if(n.url){window.location=n.url;return}}if(d.onErrorFlash&&n.messages){if(d.trigger){SABAI.popover(d.trigger,{content:n.messages[0],html:true,container:d.trigger.closest(".sabai"),title:d.trigger.attr("data-sabaipopover-title")||""});d.trigger.attr("onclick","return false;")}else{SABAI.flash(n.messages,"danger")}}}catch(o){SABAI.console.log("Failed parsing response:<p>"+m.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+o.toString()+"</p>")}};if(d.trigger){if(d.trigger.hasClass("sabai-disabled")){return}if(d.trigger.data("cookie-name")&&d.trigger.data("cookie-value")){c.cookie(d.trigger.data("cookie-name"),d.trigger.data("cookie-value"),{path:SABAI.path,domain:SABAI.domain})}if(!d.url){d.url=d.trigger.data("sabai-remote-url")}if(d.trigger.hasClass("sabai-dropdown-link")){d.trigger=d.trigger.closest(".sabai-btn-group").find(".sabai-dropdown-toggle")}}if(!d.url){return}if(d.container){e=d.container;if(d.container==="#sabai-modal"){j=SABAI.modal()}else{if(d.target){j=c(d.container).find(d.target);e=d.container+" "+d.target}else{j=c(d.container)}if(!j.length){SABAI.console.log(e);return}}}if(d.cache&&d.type==="get"){var f=SABAI.cache(d.container+d.url);if(f){i(f,j);return}}if(d.onSendData){if(typeof d.data!=="object"){d.data={}}d.onSendData(d.data,d.trigger)}if(typeof d.data==="object"){if(!d.data.hasOwnProperty("__ajax")){d.data.__ajax=e||1}d.data=c.param(d.data)}else{if(typeof d.data==="string"&&d.data!==""){d.data+="&__ajax="+(e?encodeURIComponent(e):1)}else{d.data="__ajax="+(e?encodeURIComponent(e):1)}}c.ajax({global:true,async:d.async,type:d.type,dataType:"html",url:d.url,data:d.data,processData:d.processData,cache:false,beforeSend:function(m){if(!d.loadingImage){return}if(j&&j.attr("id")!=="sabai-content"&&j.is(":visible")){g=j.attr("id")==="sabai-modal"?j.find(".sabai-modal-content"):j;SABAI.ajaxLoader(d.trigger,false,g)}else{SABAI.ajaxLoader(d.trigger)}},complete:function(m,n){switch(n){case"success":if(m.status==278||m.getResponseHeader("content-type").indexOf("json")>-1){k(m.responseText,j)}else{i(m.responseText,j);if(d.type=="get"){if(d.cache){SABAI.cache(d.container+d.url,m.responseText,d.cacheLifetime)}}}break;case"error":h(m.responseText,j);break}if(d.loadingImage){SABAI.ajaxLoader(d.trigger,true,g)}}})};SABAI.scrollTo=function(e,d,f){e=e instanceof jQuery?e:c(e);d=typeof d!=="undefined"&&d!==null?d:1000;f=typeof f!=="undefined"&&f!==null?f:0;c.sabaiScrollTo(e,d,{offset:{top:f}})};SABAI.states=function(q,g,k){var h={},o={enabled:"disabled",optional:"required",visible:"invisible",unchecked:"checked",expanded:"collapsed",unload_options:"load_options",show_options:"hide_options"},l=function(r,u,v,t){var s=c(r,t);if(!s.length){return}s.each(function(){var A,x,B,z,w;for(A in v){B=v[A];x=c(this).closest(B.container||"form").find(A);if(!x.length){SABAI.console.log("Invalid or non existent dependee selector: "+A);continue}z=[];switch(B.type){case"checked":case"unchecked":case"selected":case"unselected":z.push("change","cloneremoved.sabai");break;case"filled":case"empty":z.push("keyup","cloneremoved.sabai");break;case"request":case"requested":z.push("requested.sabai");break;case"values":default:z.push("keyup","change","cloneremoved.sabai")}h[A]={};for(var y=0;y<z.length;y++){w={selector:r,action:u};w.conditions=v;w.container=B.container||"form";x.bind(z[y],w,function(C,D){j(c(this),C.data.selector,C.data.action,C.data.conditions,C.data.container,C.type,D);C.stopPropagation()});h[A][z[y]]=true}}})},j=function(x,A,v,z,t,s,w){var y=true,r,B,u,C=x.closest(t);for(r in z){B=C.find(r);if(!B.length){y=false;break}u=z[r];if(!n(B,u.type||"value",u.value)){y=false;break}}if(v in o){v=o[v];y=!y}m(C.find(A),v,y,x,s,w,A)},n=function(u,w,x){switch(w){case"value":case"values":if(typeof x!=="object"){x=[x]}var z=[];if(u.length>1){u.each(function(){if(this.type==="checkbox"||this.type==="radio"){if(this.checked){z.push(this.value)}}else{z.push(c(this).val())}})}else{z.push(u.val())}var v=x.length,t=z.length;loop1:for(var s=0;s<v;s++){loop2:for(var r=0;r<t;r++){if(typeof x[s]!=="object"){if(x[s]==z[r]){if(w==="value"){return true}continue loop1}}else{if(d(x[s][0],z[r],x[s][1])){if(w==="value"){return true}continue loop1}}}if(w==="values"){return false}}return w==="values"?true:false;case"checked":case"unchecked":var y=false;u.each(function(){if(c(this).prop("checked")===Boolean(x)){y=true;return false}});return w==="checked"?y:!y;case"empty":case"filled":case"selected":var y=false;u.each(function(){if((c.trim(u.val())==="")===Boolean(x)){y=true;return false}});return w==="empty"?y:!y;case"collapsed":case"expanded":var y=false;u.each(function(){if((u.hasClass("sabai-form-collapsible")&&u.hasClass("sabai-form-collapsed"))===Boolean(x)){y=true;return false}});return w==="collapsed"?y:!y;case"request":return u.data("request-url")&&u.data("request-result")===x;case"requested":if(u.data("request-url")){var y=u.data("request-result");return(y==="success"||y==="error")===Boolean(x)}return false;default:alert("Invalid condition type: "+w);return false}},d=function(s,r,t){switch(t){case"==":return s==r;case"!=":return s!=r;case"<":return s<r;case">":return s>r}},m=function(A,u,z,y,s,x,t){switch(u){case"disabled":A.find(":input").prop("disabled",z);break;case"required":A.toggleClass("sabai-form-field-required",z);break;case"invisible":A.toggleClass("sabai-form-states-invisible",z);if(z){A.hide();if(x){}else{A.prev(".sabai-form-field").parent().find(".sabai-form-field:visible:last").addClass("sabai-form-field-no-margin")}}else{if(A.is(":hidden")){if(x){A.show()}else{A.css("opacity",0).slideDown("fast").animate({opacity:1},{queue:false,duration:"slow"}).prev(".sabai-form-field").removeClass("sabai-form-field-no-margin")}}}break;case"checked":A.find(":checkbox").prop("checked",z).change();break;case"load_options":if(s!=="change"){return}var D=A.find("select");D.find('option[value!=""]').remove();var v=h[t+" select"]&&h[t+" select"].change;if(z){var r=D.data("load-url"),C=r+y.val(),w=SABAI.cache(C),B=function(F){SABAI.cache(C,F);if(typeof F!=="undefined"&&F.length===0){A.hide();D.data("default-value","").val("");if(v){D.trigger("change",[x])}return}c.each(F,function(H,I){D.append(c("<option></option>").text(I[1]).val(I[0]))});if(!k){var E=D.data("default-value");if(typeof E!="undefined"){D.val(E);if(v){D.trigger("change",[x])}}}if(!A.hasClass("sabai-form-states-invisible")&&A.is(":hidden")&&D.find('option[value!=""]').length){A.removeClass("sabai-hidden").addClass("sabai-was-hidden");var G=A.find(".sabai-form-field-prefix").length?"inline-block":"block";if(x){A.css("display",G)}else{A.hide().css("display",G).fadeIn("fast")}}};if(w!==false){B(w)}else{y.addClass("sabai-ajax-loading");c.getJSON(r,{value:y.val()},B).always(function(){y.removeClass("sabai-ajax-loading")})}}else{if(!A.is(":hidden")&&A.hasClass("sabai-was-hidden")){A.hide();D.data("default-value","").val("");if(v){D.trigger("change",[x])}}}break;case"request_url":if(z){SABAI.ajax({target:A,url:A.data("request-url"),onSuccess:function(E,G,F){A.data("request-result","success").trigger("requested.sabai")},onError:function(E,G,F){A.data("request-result","error").trigger("requested.sabai")},onContent:function(E,G,F){A.data("request-result","error").trigger("requested.sabai")}})}else{A.data("request-result","")}break;case"collapsed":if(!A.hasClass("sabai-form-collapsible")){return}if((z&&!A.hasClass("sabai-form-collapsed"))||(!z&&A.hasClass("sabai-form-collapsed"))){A.find("a.sabai-form-collapsible:first").click()}break;case"hide_options":if(!z||!y.prop("checked")){return}A.find("input").each(function(){var G=c(this),E=G.data("values"),F=G.closest(".sabai-form-field");F[E&&(-1!==c.inArray(y.val(),E))?"slideDown":"hide"]()});break;default:alert("Invalid action: "+u)}},i,f,p,e;for(i in q){f=q[i];for(action in f){l(i,action,f[action]["conditions"],g)}}for(p in h){for(e in h[p]){c(p,g).trigger(e,[true])}}};SABAI.cloneField=function(d,l,e,g,f){var m=c(d),h=m.find("> .sabai-form-field:not(.sabai-form-field-add)"),i=g||h.length;if(e&&i>=e){return}var k=h.first(),j=k.clone().attr("id","sabai-"+SABAI.guid()).find(":input").each(function(){var n=jQuery(this);if(n.attr("name")){field_name=f.data("field-form-wrap")?f.data("field-form-wrap")+"["+l+"]":l;n.attr("name",n.attr("name").replace(field_name+"[0]",field_name+"["+i+"]"))}if(n.attr("id")){n.attr("id",n.attr("id")+"-"+i)}n.removeData("default-value").removeAttr("data-default-value");if(c.fn.uniform&&n.parent().is(".selector")){n.prev("span").remove().end().unwrap().uniform().parent(".selector").show()}}).end().clearInput().removeClass("sabai-form-field-error").find("span.sabai-form-field-error").remove().end().find(".sabai-was-hidden").hide().end().hide().insertAfter(h.last());j.append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').slideDown("fast").focusFirstInput().find("a.sabai-form-field-remove").click(function(n){c(this).closest(".sabai-form-field").fadeTo("fast",0,function(){c(this).slideUp("fast",function(){c(this).remove();var o=m.find("> .sabai-form-field:not(.sabai-form-field-add)");if(e&&o.length<e){f.show()}o.find(":input").trigger("cloneremoved.sabai")})});n.preventDefault()}).parent().css("position","relative");c(SABAI).trigger("clonefield.sabai",{container:d,field:k,clone:j,index:i});if(e&&f&&i+1>=e){f.hide()}};SABAI.addOption=function(d,l,e,f,m){var n=c(d),k=c(e).closest(".sabai-form-field-option"),o=n.find("> .sabai-form-field-option"),j=f?l+"[default][]":l+"[default]",g=k.find("input[name='"+j+"']").val(),h=k.clone().find(":text").each(function(){var i=jQuery(this);if(!i.attr("name")){return}i.attr("name",i.attr("name").replace(l+"[options]["+g+"]",l+"[options]["+o.length+"]"))}).end().clearInput().find("input[name='"+j+"']").val(o.length).end().hide().insertAfter(k);if(m){m.call(null,h)}h.slideDown("fast").focusFirstInput();return false};SABAI.removeOption=function(d,e,g){var f=c(d).find("> .sabai-form-field-option:not(.sabai-form-field-option-disabled)");if(f.length===1){f.clearInput();return}if(!confirm(g)){return false}c(e).closest(".sabai-form-field-option").slideUp("fast",function(){c(this).remove()})};SABAI.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var e=Math.random()*16|0,d=f=="x"?e:(e&3|8);return d.toString(16)})};if(window.history&&window.history.pushState){var b=false,a=window.location.href.replace(/%2F/g,"/");c(window).on("popstate",function(f){if(!b){b=true;if(location.href.replace(/%2F/g,"/")==a){return}}var d=f.originalEvent.state;if(d){d.data.__ajax=d.target?d.container+" "+d.target:d.container;SABAI.ajax(d);c(SABAI).trigger("sabaipopstate.sabai",d)}else{window.location.href=window.location.href}})}SABAI.parseUrl=function(d){var f=d?c("<a/>").prop("href",d)[0]:window.location;f.query={};if(f.search&&typeof f.search=="string"){var e=f.search.substr(1).replace(/\+/g,"%20").split("&");c.each(e,function(g,k){var j=k.split("=");try{j[1]=decodeURIComponent(j[1])}catch(h){}f.query[j[0]]=j[1]})}return f};SABAI.getScript=function(e,d,f){d=c.extend(d||{},{dataType:"script",cache:true,url:e});return jQuery.ajax(d,f)};c.fn.sabai=function(){SABAI.init(this)};c.fn.focusTextRange=function(g,d){if(this.is('input[type="text"]')||this.is("textarea")){var f=this.get(0);if(f.setSelectionRange){f.focus();f.setSelectionRange(g,d)}else{if(f.createTextRange){var e=f.createTextRange();e.collapse(true);e.moveEnd("character",d);e.moveStart("character",g);e.select()}}}return this};c.fn.focusFirstInput=function(){var e=this.find('input[type="text"],input[type="password"],textarea').not(".sabai-focus-off").filter(":visible:first");if(!e.length){return this}var d=e.val().length;e.focusTextRange(d,d);return this};c.fn.clearInput=function(){return this.each(function(){var f=c(this),d=f.get(0).tagName.toLowerCase();if(typeof f.data("default-value")!=="undefined"){f.val(f.data("default-value"));return}if(d==="input"){var e=f.attr("type");if(e==="checkbox"||e==="radio"){f.prop("checked",false)}else{f.val("")}}else{if(d==="textarea"){f.val("")}else{if(d==="select"){f.prop("selectedIndex",0)}else{return f.find(":input").clearInput()}}}})}})(jQuery);